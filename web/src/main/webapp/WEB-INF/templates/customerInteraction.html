<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<th:block th:include="fragments/common_meta_title"></th:block>
<th:block th:include="fragments/head"></th:block>
<th:block th:include="fragments/common_css"></th:block>

<link rel="stylesheet" type="text/css" th:href="@{/resources/css/new_style.css}">
<link rel="stylesheet" type="text/css" th:href="@{/resources/css/buttonGroupFunction.css}">
	
</head>
<body>
<!-- 	class="vertical-layout vertical-compact-menu 2-columns menu-expanded fixed-navbar" -->
<!-- 	data-open="click" data-menu="vertical-compact-menu" -->
<!-- 	data-col="2-columns" -->

	<!-- BEGIN HEADER -->
	<th:block th:include="fragments/hmenu"></th:block>
	<!-- END HEADER -->

	<!-- BEGIN CONTENT -->
	<div id="content-container">
		<!-- Nội dung trang sẽ được cập nhật ở đây -->
	</div>
	<div class="container mt-4">
		<div class="interact-day-group d-flex flex-row mb-3 w-50">
			<label for="interaction-time" class="mr-4 w-25">Tương tác mới
				nhất cách đây</label> <select name="week" class="form-select"
				id="interaction-weeks" onchange="selectChange()">
				<option selected value="" th:selected="${param.week == 0}">Chọn
					giá trị</option>
				<option value="0" th:selected="${param.week == 0}">Tất cả</option>
				<option value="1" th:selected="${param.week == 1}">1 tuần</option>
				<option value="2" th:selected="${param.week == 2}">2 tuần</option>
				<option value="3" th:selected="${param.week == 3}">3 tuần</option>
			</select>
		</div>

		<div class="search-bar d-flex justify-content-end mb-2">
			<form id="frmSearchCustomer" action="interact" method="get">
					<fieldset
						class="form-group relative has-icon-left col-12 ">
						<input class="form-control" name="keyword" id="iconLeft"
							type="text" placeholder="Tìm kiếm thông tin..."
							onkeypress="handleKeyPress(event)">
						<div class="form-control-position">
							<i class="fa fa-search"></i>
						</div>
					</fieldset>
				</form>
			<!-- Thêm thẻ div này để hiển thị kết quả tìm kiếm -->
			<div id="searchResults"></div>
		</div>

		<div class="table-container">
			<div class="table-responsive">
				<table id="table"
					class="table table-bordered table-striped table-hover"
					style="table-layout: fixed; width: 100%">
					<thead class="thead">
						<tr class="bg">
							<th class="col-stt th1" style="width: 50px;">STT</th>
							<th class="col-name th2" style="width: 250px;">Tên khách hàng</th>
							<th class="col-email th3" style="width: 350px; white-space: normal; word-wrap: break-word;">Email</th>
							<th class="col-phone th4" style="width: 150px;">Số điện thoại</th>
							<th class="col-contact th5" style="width: 200px;">Người liên hệ chính</th>
							<th class="col-action th6" style="width: 200px;">Hành động</th>
						</tr>
					</thead>
					<tbody class="bg-transparent">
						<tr th:each="customer, iterStat : ${customers}">
							<td th:text="${iterStat.index + 1}" style="width: 50px;"></td>
							<td th:text="${customer.companyName != null ? customer.companyName : ''}" style="width: 250px;"></td>
							<td th:text="${customer.email != null ? customer.email : ''}" style="width: 350px; white-space: normal; word-wrap: break-word;"></td>
							<td th:text="${customer.phone != null ? customer.phone : ''}" style="width: 150px;"></td>
							<td th:text="${customer.contactPerson != null ? customer.contactPerson : ''}" style="width: 200px;">Người liên hệ chính></td>
							
							<td>
								<th:block th:with="isCreator=${customer.createdBy == currentUsername}">
									
									<div class="d-flex justify-content-center">
										<a th:href="@{/customer/interact-edit(id=${customer.id})}" th:attr="disabled=${!isCreator}"
											th:classappend="${!isCreator} ? ' disabled-link'"
											th:disabled="${!isCreator}"
											th:style="${!isCreator} ? 'color: #ccc !important; cursor: not-allowed;' : ''"
											class="text-info mr-1 bg-transparent">
											<i class="fas fa-edit w-100" style="font-size: 25px;"></i>
										</a>
										<a th:href="@{/customer/interact-edit(id=${customer.id})}" th:attr="disabled=${!isCreator}"
											th:classappend="${!isCreator} ? ' disabled-link'"
											th:disabled="${!isCreator}"
											th:style="${!isCreator} ? 'color: #ccc !important; cursor: not-allowed;' : ''"
											class="text-info mr-1 bg-transparent">
											<i class="fas fa-envelope w-100" style="font-size: 25px;"></i>
										</a>
										<a th:href="@{/customer/interact-edit(id=${customer.id})}" th:attr="disabled=${!isCreator}"
											th:classappend="${!isCreator} ? ' disabled-link'"
											th:disabled="${!isCreator}"
											th:style="${!isCreator} ? 'color: #ccc !important; cursor: not-allowed;' : ''"
											class="text-info mr-1 bg-transparent">
											<i class="fas fa-comment-sms w-100" style="font-size: 25px;"></i>
										</a>
									</div>
									
								</th:block>
								
							</td>
							
						</tr>
					</tbody>
				</table>
			</div>
		</div>
	</div>
	<!-- END CONTENT -->

	<!-- START CUSTOMIZE BUTTON -->
	<th:block th:include="fragments/customizeButton"></th:block>
	<!-- END CUSTOMIZE BUTTON -->

</body>
<script type="text/javascript">
	function selectChange() {
		const week = document.getElementById("interaction-weeks").value;
		const url = new URL(window.location.href);
		url.searchParams.set('week', week);
		window.location.href = url.toString();
	}
</script>
<!-- START COMMON JAVASCRIPT -->
<th:block th:include="fragments/common_javascript"></th:block>
<!-- END COMMON JAVASCRIPT -->
<script type="text/javascript"
	src="resources/app-assets/js/update/search.js"></script>
<script type="text/javascript"
	th:src="@{/resources/app-assets/js/update/customerList_JS.js}"></script>
</html>