<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
<!-- START COMMON META AND TITLE -->
<th:block th:include="fragments/common_meta_title"></th:block>
<!-- END COMMON META AND TITLE -->

<!-- START COMMON CSS -->
<th:block th:include="fragments/common_css"></th:block>
<!-- END COMMON CSS -->

<link rel="stylesheet" type="text/css" href="resources/css/add-customer-style.css">
</head>

<body
	class="vertical-layout vertical-compact-menu 2-columns menu-expanded fixed-navbar"
	data-open="click" data-menu="vertical-compact-menu"
	data-col="2-columns">

	<!-- BEGIN HEADER -->
	<th:block th:include="fragments/hmenu"></th:block>
	<!-- END HEADER -->

	<!-- BEGIN LEFT MENU NAVIGATION -->
<!-- 	<th:block th:include="fragments/leftNavCRM"></th:block> -->
	<!-- END LEFT MENU NAVIGATION -->

    <th:block th:include="fragments/frm_formCustomer"></th:block>

	<!-- START CUSTOMIZE BUTTON -->
	<th:block th:include="fragments/customizeButton"></th:block>
	<!-- END CUSTOMIZE BUTTON -->

	<!-- START COMMON JAVASCRIPT -->
	<th:block th:include="fragments/common_javascript"></th:block>
	<!-- END COMMON JAVASCRIPT -->
	
	<!-- FILE JS BỔ SUNG -->
	<script type="text/javascript" src="resources/app-assets/js/update/navigate.js"></script>
	<script type="text/javascript">
		/* function addCustomer(event) {
			const createdAt = new Date().toISOString();
			document.getElementById("addNewCustomerForm").created_at = createdAt;
		}   */
		function goBack() {
	        window.location.href = '/crm-web/customer/list';
	    }
	</script>
	<script>
		document.getElementById('addCustomerForm').addEventListener('submit', function (event) {
		    event.preventDefault(); // Ngăn form gửi yêu cầu mặc định
	
		    const getValueOrNull = (id) => {
	            const value = document.getElementById(id).value.trim();
	            return value === '' ? null : value;
	        };
		    // Thu thập dữ liệu từ form
		    const formData = {
		    		company_name: getValueOrNull('company_name'),
		            contact_person: getValueOrNull('contact_person'),
		            email: getValueOrNull('email'),
		            phone: getValueOrNull('phone'),
		            address: getValueOrNull('address'),
		            profession: getValueOrNull('profession'),
		            main_status: getValueOrNull('main_status'),
		            sub_status: getValueOrNull('sub_status'),
		            responsible_person: getValueOrNull('responsible_person'),
		            note: getValueOrNull('note'),
		    };
	
		    // Gửi yêu cầu POST tới API
		    fetch('/crm-web/customer/create-customer', { 
		        method: 'POST',
		        headers: {
		            'Content-Type': 'application/json',
		        },
		        body: JSON.stringify(formData),
		    })
		        .then(response => {
		            if (!response.ok) {
		                throw new Error('Network response was not ok');
		            }
		            return response.json();
		        })
		        .then(data => {
		            alert('Thêm khách hàng thành công!');
		            console.log('Response:', data);
		            // Xử lý hành động sau khi lưu thành công, ví dụ chuyển hướng hoặc làm mới form
		        })
		        .catch(error => {
		            console.error('Có lỗi xảy ra:', error);
		            alert('Không thể thêm khách. Vui lòng thử lại!');
		        });
		});
	</script>
</body>
</html>
