<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>

</head>
<style>
	@keyframes ring {
	    0% { transform: rotate(0); }
	    10% { transform: rotate(15deg); }
	    20% { transform: rotate(-10deg); }
	    30% { transform: rotate(15deg); }
	    40% { transform: rotate(-10deg); }
	    50% { transform: rotate(7deg); }
	    60% { transform: rotate(-7deg); }
	    70% { transform: rotate(5deg); }
	    80% { transform: rotate(-5deg); }
	    90% { transform: rotate(2deg); }
	    100% { transform: rotate(0); }
	}
	
	.bell-icon {
	    width: 30px;
	    height: 30px;
	    animation: ring 2s infinite;
	}
	
	.modal-overlay {
        position: fixed;
        top: 0; left: 0;
        width: 100vw;
        height: 100vh;
        background-color: rgba(0, 0, 0, 0.5); /* N·ªÅn m·ªù */
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 9999;
    }

    .modal-content-reminder {
        background: white;
        border-radius: 16px;
        width: 90%;
        max-width: 500px;
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
        animation: fadeIn 0.3s ease;
        position: fixed;
        
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: scale(0.95); }
        to { opacity: 1; transform: scale(1); }
    }
    
    .modal-body ul {
	    list-style: none;
	    padding: 0;
	}
	
	.modal-body li {
	    margin-bottom: 8px;
	    text-align: justify;
	}
    
</style>
<body>
	<!-- Ch·ªâ hi·ªÉn th·ªã modal n·∫øu c√≥ th√¥ng b√°o -->
	<div th:if="${hasTaskNotification}" id="reminderModal" class="modal-overlay show">
	    <audio id="reminderSound" autoplay>
	        <source src="resources/audio/new-notification-09-352705.mp3" type="audio/mpeg">
	    </audio>
	
	    <div class="modal-content-reminder">
	        <div class="modal-header" style="border-radius: 16px; background-color: #a283fc; ">
			    <h2 style="color: yellow; position: relative;">
			        <span style="position: relative; display: inline-block;">
			            <img src="resources/Image/bell.png" class="bell-icon" />
			            <span style="
			                position: absolute;
			                top: -8px;
			                right: -8px;
			                background: red;
			                color: white;
			                border-radius: 50%;
			                padding: 3px 6px;
			                font-size: 12px;
			                font-weight: bold;
			            ">
			                <span th:text="${taskNotificationCount + customerCareNotificationCount}"></span>
			            </span>
			        </span>
			        &nbsp;REMINDER
			    </h2>
			</div>
	
	        <div class="modal-body">
	            <ul>
	            	<li style="font-weight: bold;">üîî C√¥ng vi·ªác</li>
	                <li th:each="noti : ${notifications}" th:text="${noti}"></li>
	                
	                <li style="margin-top: 10px; font-weight: bold;">üíº ChƒÉm s√≥c kh√°ch h√†ng</li>
        			<li th:each="noti : ${customerCareNotifications}" th:text="${noti}"></li>
	            </ul>
	        </div>
	
	        <div class="modal-footer" style="margin-bottom: 10px; margin-right: 5px">
	            <button class="btn btn-success" onclick="hideReminder()">ƒê√É HI·ªÇU</button>
	            <button class="btn btn-danger" onclick="hideReminder()">ƒê√ìNG</button>
	        </div>
	    </div>
	</div>
	
	<!-- Chu√¥ng + s·ªë l∆∞·ª£ng hi·ªÉn th·ªã ·ªü g√≥c -->
<!-- 	<div th:if="${hasTaskNotification}" style="text-align: center; position: relative; margin-top: 10px;"> -->
<!-- 	    <img src="resources/Image/bell.png" class="bell-icon" /> -->
<!-- 	    <span style="position: absolute; top: -10px; right: 0; background: red; color: white; border-radius: 50%; padding: 4px 7px; font-size: 20px;"> -->
<!-- 	        <span th:text="${taskNotificationCount}"></span> -->
<!-- 	    </span> -->
<!-- 	</div> -->
	<script th:inline="javascript">
	    let hasNotification = /*[[${hasTaskNotification}]]*/ false || /*[[${hasCustomerCareNotification}]]*/ false;
	
	    if (hasNotification) {
	    	console.log("C√≥ th√¥ng b√°o m·ªõi");
	        notifyUser("üîî C√≥ th√¥ng b√°o m·ªõi", "Vui l√≤ng ki·ªÉm tra c√¥ng vi·ªác ho·∫∑c chƒÉm s√≥c kh√°ch h√†ng.");
	        startFlashingTitle("üîî TH√îNG B√ÅO M·ªöI!");
	    }
	</script>

	
	<script>
	    function hideReminder() {
	        const modal = document.getElementById("reminderModal");
	        if (modal) {
	            modal.style.display = "none";
	        }
	        stopFlashingTitle();
	    }
		
	    
	    window.addEventListener("DOMContentLoaded", () => {
	        const sound = document.getElementById("reminderSound");
	        if (sound) {
	            try {
	                sound.play();
	            } catch (e) {
	                console.warn("Tr√¨nh duy·ªát ch·∫∑n t·ª± ƒë·ªông ph√°t √¢m thanh:", e);
	            }
	        }
	        
// 	        const hasNotification = /*[[${hasTaskNotification}]]*/ false || /*[[${hasCustomerCareNotification}]]*/ false;
	        
// 	        if(hasNotification){
// 	        	notifyUser("üîî C√≥ th√¥ng b√°o m·ªõi", "Vui l√≤ng ki·ªÉm tra c√¥ng vi·ªác ho·∫∑c chƒÉm s√≥c kh√°ch h√†ng.");
// 	        	startFlashingTitle("üîî TH√îNG B√ÅO M·ªöI!");
// 	        }
	    });
	    
	    function notifyUser(title, message){
	    	if(!("Notification" in window)){
	    		console.warn("Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ Web Notification");
	    		return;
	    	}
	    	if (Notification.permission === "granted") {
	            new Notification(title, { body: message });
	        } else if (Notification.permission !== "denied") {
	            Notification.requestPermission().then(permission => {
	                if (permission === "granted") {
	                    new Notification(title, { body: message });
	                }
	            });
	        }
	    }
	    
	    //Flash tab title
	    let originalTitle = document.title;
	    let flashTitleInterval = null;
	    
	    function startFlashingTitle(flashText = "üîî C√≥ th√¥ng b√°o!"){
	    	if(flashTitleInterval) return;
	    	flashTitleInterval = setInterval(() => {
	    		document.title = document.title === flashText ? originalTitle : flashText;
	    	}, 1000);
	    }
	    
	    function stopFlashingTitle() {
	    	clearInterval(flashTitleInterval);
	    	flashTitleInterval = null;
	    	document.title = originalTitle;
	    }
	</script>
		
</body>
</html>