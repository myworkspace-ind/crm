<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<style>
	#responsibleModal {
  		--bs-modal-width: 800px;
	}
</style>
	<!-- BEGIN CONTENT -->
	<div class="app-content content">
		<div class="content-body">
			<section class="row">
				<div class="col-12">
					<div class="card">
						<div class="card-header">
							<h4 class="card-title" th:text="${customer?.id != null ? 'Ch·ªânh S·ª≠a Kh√°ch H√†ng' : 'Th√™m Kh√°ch H√†ng M·ªõi'}"></h4>
						</div>
						<div class="card-content">
							<div class="card-body">
								<form id="updateCustomerForm" th:action="@{/customer/newedit-customer}" method="post">
									<input type="hidden" id="customer_id" name="id" th:value="${customer?.id}"> <!-- Gi√° tr·ªã n√†y c√≥ th·ªÉ l√† ID c·ªßa kh√°ch h√†ng hi·ªán t·∫°i -->
									<div class="form-group">
										<label for="company_name">T√™n C√¥ng Ty:</label>
										<input type="text" class="form-control" id="company_name" name="company_name"  maxlength="99"
										   th:value="${customer?.companyName}" required>
									</div>

									<div class="form-group">
										<label for="contact_person">Ng∆∞·ªùi Li√™n H·ªá Ch√≠nh:</label>
										<input type="text" class="form-control" id="contact_person" name="contact_person" maxlength="99"
										   th:value="${customer?.contactPerson}" required>
									</div>

									<div class="form-group">
										<label for="email">Email:</label>
										<input type="email" class="form-control" id="email" name="email" maxlength="99"
										   th:value="${customer?.email}" required>
									</div>

									<div class="form-group">
										<label for="phone">S·ªë ƒêi·ªán Tho·∫°i:</label>
										<input type="tel" pattern="[0-9]{10}" class="form-control" id="phone" name="phone" maxlength="10"
										   th:value="${customer?.phone}" required>
									</div>

									<div class="form-group">
										<label for="address">ƒê·ªãa Ch·ªâ:</label>
										<div class="d-flex align-items-center">
											<input type="text" class="form-control me-2" id="address" name="address" maxlength="255"
												   th:value="${customer?.address}" required>
											<button type="button" id="address-btn" class="btn btn-outline-secondary">üìç</button>
										</div>
									</div>


									<div class="form-group">
										<label for="profession">Ng√†nh Ngh·ªÅ:</label>
										<select class="form-control" id="profession" name="profession" required>
											<option value="">Ch·ªçn Ng√†nh Ngh·ªÅ</option>
											<th:block th:each="profession : ${professions}">
												<option th:value="${profession.id}"
													th:text="${profession.name}"
													th:selected="${profession.id == customer?.profession?.id}"></option>
											</th:block>
											<option value="customProfession" class="custom-option" id="custom-Customer"
											  style="font-weight: bold; background-color: #f0f8ff; display: flex; align-items: center; padding-right: 25px;">
											  T√πy Ch·ªânh
											</option>
										</select>
									</div>

									<div class="form-group">
										<label for="main_status">Tr·∫°ng Th√°i Ch√≠nh:</label>
										<select class="form-control" id="main_status" name="main_status" required>
											<option value="">Ch·ªçn Tr·∫°ng Th√°i Ch√≠nh</option>
											<th:block th:each="status : ${statuses}">
												<option th:value="${status.id}"
													th:text="${status.name}"
													th:selected="${status.id == customer?.mainStatus?.id}"></option>
											</th:block>
											<option value="customStatus" class="custom-option" id="custom-Customer"
											  style="font-weight: bold; background-color: #f0f8ff; display: flex; align-items: center; padding-right: 25px;">
											  T√πy Ch·ªânh
											</option>
										</select>
									</div>

									<div class="form-group">
										<label for="sub_status">Tr·∫°ng Th√°i Ph·ª•:</label>
										<select class="form-control" id="sub_status" name="sub_status" required>
											<option value="">Ch·ªçn Tr·∫°ng Th√°i Ph·ª•</option>
											<th:block th:each="status : ${statuses}">
												<option th:value="${status.id}"
													th:text="${status.name}"
													th:selected="${status.id == customer?.subStatus?.id}"></option>
											</th:block>
											<option value="customStatus" class="custom-option" id="custom-Customer"
											  style="font-weight: bold; background-color: #f0f8ff; display: flex; align-items: center; padding-right: 25px;">
											  T√πy Ch·ªânh
											</option>
										</select>
									</div>

									<div class="form-group">
										<label for="responsible_person">Ng∆∞·ªùi Ph·ª• Tr√°ch:</label>
										<select class="form-control" id="responsible_person" name="responsible_person" required>
											<option value="">Ch·ªçn Ng∆∞·ªùi Ph·ª• Tr√°ch</option>
											<th:block th:each="person : ${responsiblePersons}">
												<option th:value="${person.id}"
													th:text="${person.name}"
													th:selected="${person.id == customer?.responsiblePerson?.id}"></option>
											</th:block>
										<option value="customPerson" class="custom-option" id="custom-Customer"
										  style="font-weight: bold; background-color: #f0f8ff; display: flex; align-items: center; padding-right: 25px;">
										  T√πy Ch·ªânh
										</option>
										</select>
									</div>

									<div class="form-group">
										<label for="note">Ghi Ch√∫:</label>
										<textarea class="form-control" id="note" name="note" maxlength="255" th:text="${customer?.note}"></textarea>
									</div>

									<button type="submit" class="btn btn-primary">L∆∞u Kh√°ch H√†ng</button>
									<a th:href = "@{/customer/list}">
										<button type="button" class="btn btn-secondary">Quay L·∫°i</button>
									</a>
								</form>
							</div>
						</div>
					</div>
				</div>
			</section>
		</div>
	</div>
	<!-- Modal CRUD Ng∆∞·ªùi ph·ª• tr√°ch -->
	<div class="modal" tabindex="-1" role="dialog" id="responsibleModal" aria-hidden="true">
	  <div class="modal-dialog" role="document">
	    <div class="modal-content" style="margin-top: 400px">
	      <div class="modal-header">
	        <h5 class="modal-title text-light" id="responsibleModalLabel" ></h5>
      	    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" data-dismiss="modal"></button>
	      </div>
	      <div class="modal-body">
	      		<span>ID s·∫Ω tƒÉng t·ª± ƒë·ªông khi ƒë∆∞·ª£c t·∫°o m·ªõi. Vui l√≤ng kh√¥ng nh·∫≠p ID!</span>
	      	    <div id="responsibleTable"></div>
	      </div>
	       <div id="success-alert" class="alert alert-success" style="display: none">
		       <button type="button" class="close" data-dismiss="alert">x</button>
		       <strong>Success! </strong> Saved.
	       </div>
	      <div class="modal-footer">
	        <button type="button" id="cancelShowBtn" class="btn btn-secondary modal-btn" data-dismiss="modal">ƒê√≥ng</button>
	      	<button type="button" class="btn btn-primary" id="saveDataButton">L∆∞u</button>
	      	
	      </div>
	    </div>
	  </div>
	</div>
	<!-- Overlay -->
	<div id="overlay" class="overlay"></div>
	
	<script>
     // Th√™m d·∫•u '*' cho c√°c tr∆∞·ªùng y√™u c·∫ßu
     document.querySelectorAll("input[required], select[required], textarea[required]").forEach((element) => {
         const label = element.previousElementSibling;
         if (label) {
             label.innerHTML += ' <span style="color: red;">*</span>';
         }
     });
     
     function handleOpenModal(event) {
    	// Ki·ªÉm tra n·∫øu gi√° tr·ªã ƒë∆∞·ª£c ch·ªçn l√† "custom" (T√πy Ch·ªânh)
 	    if (event.target.value === 'customPerson' ||
	    		event.target.value === 'customProfession' ||
	    		event.target.value === 'customStatus') {
 	     // L·∫•y ph·∫ßn t·ª≠ select
 	     let titleModal;
 	     if(event.target.value === 'customPerson'){
 	    	 titleModal = 'Qu·∫£n l√Ω ng∆∞·ªùi ph·ª• tr√°ch';
 	     }
 	     else if(event.target.value === 'customProfession'){
 	    	 titleModal = 'Qu·∫£n l√Ω ng√†nh ngh·ªÅ';
 	     }
 	     else{
 	    	 titleModal = 'Qu·∫£n l√Ω tr·∫°ng th√°i ng∆∞·ªùi d√πng';
 	     }
	   	     document.getElementById('responsibleModalLabel').innerText = titleModal;
	   	  	 loadTableData(event.target.value);
 	        // L·ª±a ch·ªçn option ƒë·∫ßu ti√™n 
 	        event.target.selectedIndex = 0;

		     const modal = new bootstrap.Modal(document.getElementById('responsibleModal'));
		     modal.show();
 	    }
     }
     document.getElementById('responsible_person').addEventListener('change', function(event) {
    	    handleOpenModal(event);
    	});
     document.getElementById('sub_status').addEventListener('change', function(event) {
 	    handleOpenModal(event);
 		});
     document.getElementById('main_status').addEventListener('change', function(event) {
 	    handleOpenModal(event);
 		});
     document.getElementById('profession').addEventListener('change', function(event) {
  	    handleOpenModal(event);
  		});

	</script>

	<!-- END CONTENT -->
</html>
