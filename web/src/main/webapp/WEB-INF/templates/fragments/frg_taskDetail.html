<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
	<!-- Task Detail Sidebar -->
	<div id="taskDetailSidebar" class="task-sidebar" style="display: none;">
	    <button class="close-btn" onclick="closeTaskSidebar()">‚úñ</button>
	    
	    <form id="taskDetailForm" method="post">
	        <input type="hidden" name="taskId" id="sidebarTaskId" />
	
	        <div class="mb-3">
	            <label class="form-label">T√™n c√¥ng vi·ªác</label>
	            <input type="text" class="form-control" id="sidebarTaskName" name="taskName" />
	        </div>
	
	        <div class="mb-3">
	            <label class="form-label">M√¥ t·∫£</label>
	            <textarea class="form-control" id="sidebarTaskDescription" name="taskDescription"></textarea>
	        </div>
	
	        <div class="mb-3">
	            <label class="form-label">Ng√†y b·∫Øt ƒë·∫ßu</label>
	            <input type="datetime-local" class="form-control" id="sidebarStartDate" name="taskStartDate" />
	        </div>
	        
	        <div class="mb-3">
			    <label class="form-label">Kh√°ch h√†ng li√™n quan</label>
			    <div id="sidebarCustomerContainer"></div>
			    <button type="button" class="btn btn-link" onclick="addSidebarCustomer()">+ Th√™m kh√°ch h√†ng</button>
			</div>
	
	        <button type="submit" class="btn btn-primary">L∆∞u</button>
	        <button type="button" class="btn btn-danger" onclick="deleteTask()">üóëÔ∏è X√≥a</button>
	    </form>
	</div>
</body>

<script>
		function openTaskSidebar(taskId, taskName, description, startDate, customers) {
		    document.getElementById('sidebarTaskId').value = taskId;
		    document.getElementById('sidebarTaskName').value = taskName;
		    document.getElementById('sidebarTaskDescription').value = description;
		    document.getElementById('sidebarStartDate').value = startDate;

		    const container = document.getElementById('sidebarCustomerContainer');
		    container.innerHTML = "";

		    customers.forEach((cust, index) => {
		        const block = document.createElement("div");
		        block.className = "customer-block mb-2";
		        block.innerHTML = `
		            <div class="row">
		                <div class="col-7">
		                    <input type="text" class="form-control" name="customers[${index}].companyName" value="${cust.companyName}" placeholder="T√™n c√¥ng ty" />
		                </div>
		                <div class="col-5">
		                    <input type="text" class="form-control" name="customers[${index}].contactPerson" value="${cust.contactPerson}" placeholder="Ng∆∞·ªùi li√™n h·ªá" />
		                </div>

		            </div>
		        `;
		        container.appendChild(block);
		    });

		    document.getElementById('taskDetailSidebar').style.display = 'block';
		}

		function closeTaskSidebar() {
		    document.getElementById('taskDetailSidebar').style.display = 'none';
		}

		function addSidebarCustomer() {
		    const container = document.getElementById('sidebarCustomerContainer');
		    const index = container.children.length;
		    const block = document.createElement("div");
		    block.className = "customer-block mb-2";
		    block.innerHTML = `
		        <div class="row">
		            <div class="col-6">
		                <input type="text" class="form-control" name="customers[${index}].companyName" placeholder="T√™n c√¥ng ty" />
		            </div>
		            <div class="col-3">
		                <input type="text" class="form-control" name="customers[${index}].contactPerson" placeholder="Ng∆∞·ªùi li√™n h·ªá" />
		            </div>
		            <div class="col-3">
		                <input type="text" class="form-control" name="customers[${index}].phone" placeholder="SƒêT" />
		            </div>
		        </div>
		    `;
		    container.appendChild(block);
		}

		function deleteTask() {
		    const taskId = document.getElementById('sidebarTaskId').value;

		    if (!taskId) {
		        Swal.fire("Kh√¥ng c√≥ ID c√¥ng vi·ªác ƒë·ªÉ x√≥a!", "", "warning");
		        return;
		    }

		    Swal.fire({
		        title: 'B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a?',
		        text: "Thao t√°c n√†y kh√¥ng th·ªÉ ho√†n t√°c!",
		        icon: 'warning',
		        showCancelButton: true,
		        confirmButtonColor: '#d33',
		        cancelButtonColor: '#6c757d',
		        confirmButtonText: 'X√≥a',
		        cancelButtonText: 'H·ªßy'
		    }).then((result) => {
		        if (result.isConfirmed) {
		            $.ajax({
		                url: _ctx + `task/${taskId}/delete`,
		                type: 'DELETE',
		                success: function() {
		                    Swal.fire("ƒê√£ x√≥a!", "C√¥ng vi·ªác ƒë√£ ƒë∆∞·ª£c x√≥a.", "success")
		                        .then(() => {
		                            closeTaskSidebar();
		                            location.reload(); // ho·∫∑c g·ªçi l·∫°i h√†m load danh s√°ch n·∫øu c√≥
		                        });
		                },
		                error: function(xhr, status, error) {
		                    console.error(error);
		                    Swal.fire("L·ªói!", "X·∫£y ra l·ªói khi x√≥a.", "error");
		                }
		            });
		        }
		    });
		}

		document.addEventListener("keydown", function(e) {
		    if (e.key === "Escape") {
		        closeTaskSidebar();
		    }
		});
</script>

</html>